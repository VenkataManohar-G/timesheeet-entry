sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/library","sap/ui/export/library","sap/m/library","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/ui/model/Sorter","sap/ui/model/Filter","sap/m/SearchField","sap/ui/table/Column","sap/m/Column","sap/m/Label","sap/ui/model/type/String","sap/ui/comp/library","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/core/message/Message","sap/ushell/Container","sap/ui/export/Spreadsheet","sap/m/MessageBox"],(e,t,a,s,i,r,n,o,l,d,g,m,u,h,c,p,w,T,D,f,y)=>{"use strict";var v,S,b=[],_=[],M=0,E=0,V=0,I,x,C;var R,k,W,P,F,B,O,H,N,O,j,A,J;var L=t.MessageType,Q=s.DialogType,K=s.ButtonType;var U,z,G,Y,Z,$,q,X,ee,te,ae,se,ie,re;var ne=t.ValueState,oe=a.EdmType;var le=new sap.ui.model.json.JSONModel,de=new sap.ui.model.json.JSONModel;var ge,me;return e.extend("timesheetentry.controller.timesheet_view",{formatWbsElement:function(e){var t,a;if(e){t=e.toString();a=t.padStart(8,"0");return a}},formatStatus:function(e){if(e==="30"){return"Success"}else if(e==="10"){return"Information"}else{return"Error"}},shellDetails:function(){var e;if(sap.ushell&&sap.ushell.Container){var t=sap.ushell.Container.getService("UserInfo");if(t){e=t.getEmail();if(!e){e="rkirlampudi@answerthink.com"}}else{e="rkirlampudi@answerthink.com"}}else{e="rkirlampudi@answerthink.com"}return e},UserDetails:async function(e){te=await this.shellDetails();if(te){this._getuserdetails(te)}},_getuserdetails:function(e){var t=[];var a,s,o;o=new sap.ui.model.Filter("Email","EQ",e);e;t.push(o);var l=new sap.m.BusyDialog({title:"Loading Data",text:"Please wait....."});l.open();W=this.getOwnerComponent().getModel("EmployeeService");W.read("/MyEmployeeData",{filters:t,urlParameters:{$top:999999},success:function(e){var t={};var a=this.getView().byId("id_employee_extid");var s=this.getView().byId("id_wrkid_add");var o=this.getView().byId("id_ccenter_add");var d=this.getView().byId("id_search");var g,m;N=new sap.ui.model.json.JSONModel;var u=this;if(e.results.length!==0){t=e.results;if(t.length!==0){N.setData(e.results);u.getView().setModel(N,"CompanyCodes");a.setText(t[0].PersonWorkAgreementExternalID);X=t[0].PersonWorkAgreement;if(t[0].PersonFullName){g=t[0].PersonWorkAgreement+" ("+t[0].PersonFullName+")";s.setText(g);s.setVisible(true)}else{g=t[0].PersonWorkAgreement;s.setText(g);s.setVisible(true)}if(t[0].CostCenterDescription){m=t[0].CostCenter+" ("+t[0].CostCenterDescription+")";o.setText(m);o.setVisible(true)}else{m=t[0].CostCenter;o.setText(m);o.setVisible(true)}if(t.length===1){ae=t[0].CompanyCode;se=t[0].CompanyCodeName}d.setEnabled(true)}else{this.oReadSuccessMessageDialog=new i({type:Q.Message,title:"Information",state:ne.Warning,content:new n({text:"No Data Found with the Selected Company Code!!..Please try with another"}),beginButton:new r({type:K.Emphasized,text:"Ok",press:function(){s.setText("");a.setText("");o.setText("");d.setEnabled(false);this.oReadSuccessMessageDialog.close()}.bind(this)})});this.oReadSuccessMessageDialog.open()}}else{this.oReadSuccessMessageDialog=new i({type:Q.Message,title:"Information",state:ne.Warning,content:new n({text:"No Employee Found"}),beginButton:new r({type:K.Emphasized,text:"Ok",press:function(){s.setText("");a.setText("");o.setText("");d.setEnabled(false);this.oReadSuccessMessageDialog.close()}.bind(this)})});this.oReadSuccessMessageDialog.open()}l.close()}.bind(this),error:function(e){this.oReadErrorMessageDialog=new i({type:Q.Message,title:"Error",state:ne.Error,content:new n({text:""+e+""}),beginButton:new r({type:K.Emphasized,text:"Ok",press:function(){this.oReadErrorMessageDialog.close()}.bind(this)})});this.oReadErrorMessageDialog.open();l.close()}.bind(this)})},onInit(){var e=this;this.UserDetails();R=this.getOwnerComponent().getModel();F=this.getOwnerComponent().getModel("TaskTypeService");B=this.getOwnerComponent().getModel("TimesheetService");e.getView().setModel(F,"Tasks");O=this.getOwnerComponent().getModel("TemplateJSONData");e.getView().setModel(O,"Template");j=new sap.ui.model.json.JSONModel({start:"",end:""});e.getView().setModel(j,"DateModel");C=this.getOwnerComponent().getModel("configurationModel");this.dateTimePeriod()},dateTimePeriod:function(){var e=new Date;var t=e.getDay();var a=this;if(t===6){var s=new Date(new Date(e).getTime()+5184e5);A=new sap.ui.model.json.JSONModel({start:e,end:new Date(new Date(e).getTime()+5184e5)});A.refresh();a.getView().setModel(A,"DateModel1")}else if(t===5){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(e).getTime()-5184e5),end:e});A.refresh();a.getView().setModel(A,"DateModel1")}else if(t===4){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(e).getTime()-432e6),end:new Date(new Date(e).getTime()+864e5)});A.refresh();a.getView().setModel(A,"DateModel1")}else if(t===3){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(e).getTime()-3456e5),end:new Date(new Date(e).getTime()+1728e5)});A.refresh();a.getView().setModel(A,"DateModel1")}else if(t===2){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(e).getTime()-2592e5),end:new Date(new Date(e).getTime()+2592e5)});A.refresh();a.getView().setModel(A,"DateModel1")}else if(t===1){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(e).getTime()-1728e5),end:new Date(new Date(e).getTime()+3456e5)});A.refresh();a.getView().setModel(A,"DateModel1")}else if(t===0){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(e).getTime()-864e5),end:new Date(new Date(e).getTime()+432e6)});A.refresh();a.getView().setModel(A,"DateModel1")}},_datediff:function(e,t){const a=1e3*60*60*24;const s=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());const i=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((i-s)/a)},handleDateChange:function(e){var t=this.getView().byId("id_search");var a=[],s=e.getParameter("from"),i=e.getParameter("to"),r=e.getParameter("value"),n=e.getParameter("valid"),o=e.getSource();if(n){o.setValueState(ne.None);a=r.split("–");if(a.length>1){I=a[0].trim();x=a[1].trim();var l=this._datediff(s,i);if(l>60){o.setValueState(ne.Error);o.setValueStateText("Date Range shouldn't exceed more than 60 days");t.setEnabled(false)}else{o.setValueState(ne.None);o.setValueStateText("");t.setEnabled(true)}}else{I=a[0].trim();x=a[0].trim();t.setEnabled(true)}}else{o.setValueState(ne.Error);o.setValueStateText("Invalid Date");t.setEnabled(false)}},onFilter:function(e){var t=this.getView().byId("id_employee_extid");var a=t.getText();var s=I;var o=x;if(a===""||s===undefined||o===undefined||s===""||o===""){this.oFillMessageDialog=new i({type:Q.Message,title:"Error",state:ne.Error,content:new n({text:"Employee Id & Date are Mandatory"}),beginButton:new r({type:K.Emphasized,text:"Ok",press:function(){this.oFillMessageDialog.close()}.bind(this)})});this.oFillMessageDialog.open()}else{this._bindtimesheet(a,s,o)}},_bindtimesheet:function(e,t,a){var s=[];var i,r,n,o,l,d,g;r=this;i=new sap.ui.model.json.JSONModel;o=new sap.ui.model.Filter("PersonWorkAgreementExternalID","EQ",e);s.push(o);if(t&&a){var m=t+"T00:00:00Z";var u=a+"T23:59:59Z";var h=new sap.ui.model.Filter("TimeSheetDate","BT",m,u);s.push(h)}else if(t){var c=t+"T00:00:00Z";var u=t+"T23:59:59Z";var h=new sap.ui.model.Filter("TimeSheetDate","BT",c,u);s.push(h)}var p=new sap.m.BusyDialog({title:"Loading Data",text:"Please wait....."});p.open();R.read("/MyTimesheetDetails",{filters:s,urlParameters:{$top:999999},success:function(e){var t;console.log(e);console.log(e.results);i.setData(e.results);r.getView().setModel(i,"Timesheet");p.close()}.bind(this),error:function(e){console.log(e);p.close()}.bind(this)})},onUpdateFinished:function(){var e=this.getView().byId("daysTable");var t=e.getItems();for(var a=0;a<t.length;a++){if(t[a].getCells()[17].getText()==="60"){t[a].getMultiSelectControl(true).setEditable(false)}else{t[a].getMultiSelectControl(true).setEditable(true)}}},onSelectionChange:function(e){var t=e.getSource();var a=t.getSelectedItems();var s=a.length;var i=this.getView().byId("id_button_cancel");var r=false;if(s>0){try{i.setEnabled(true);a.forEach(function(e,t){var a=e.getCells()[17].getText();if(a==="60"){r=true;throw"Already deleted"}})}catch(e){i.setEnabled(false)}}else{i.setEnabled(false)}},onAdd:function(e){var t=this;v=this.byId("id_dialogaddentries");k=new sap.ui.model.json.JSONModel;for(S=0;S<=4;S++){var a={};a.Id=S;a.TimesheetDate="";a.TaskType="";a.WBSElemt="";a.RecordedHours="0";a.RecordedQuantity="0";b.push(a)}k.setData(b);t.getView().setModel(k,"Entries");k.refresh(true);if(!v){v=new sap.ui.xmlfragment(this.getView().getId(),"timesheetentry.view.AddTimesheetEntries",this);this.getView().addDependent(v);v.open();var s=this.getView().byId("id_add_employee_extid");var i=this.getView().byId("id_add_wrkid");var r=this.getView().byId("id_add_ccode");s.setText(this.getView().byId("id_employee_extid").getText());i.setText(this.getView().byId("id_wrkid_add").getText());if(ae){r.setSelectedKey(ae)}if(se){r.setValue(se)}}else{v.open();var s=this.getView().byId("id_add_employee_extid");var i=this.getView().byId("id_add_wrkid");var r=this.getView().byId("id_add_ccode");s.setText(this.getView().byId("id_employee_extid").getText());i.setText(this.getView().byId("id_wrkid_add").getText());if(ae){r.setSelectedKey(ae)}if(se){r.setValue(se)}}},onAddEntry:function(e){var t=this;var a={};S=S+1;a.Id=S;a.TimesheetDate="";a.TaskType="";a.WBSElemt="";a.RecordedHours="0";a.RecordedQuantity="0";b.push(a);k.setData(b);t.getView().setModel(k,"Entries");k.refresh(true)},deleteRow:function(e){var t;t=this;var a=e.getParameter("listItem");var s=a.getCells();var i=s[0].getValue();var r=i*1;const n=b.findIndex(e=>e.Id===r);if(n!==-1){b.splice(n,1);k.setData(b);t.getView().setModel(k,"Entries");k.refresh(true)}var o=this.getView().byId("tableId1");o.removeItem(e.getParameter("listItem"))},onCloseDialog:function(){var e;e=this;b=[];M=0;k.setData(b);e.getView().setModel(k,"Entries");k.refresh(true);sap.ui.getCore().getMessageManager().removeAllMessages();this.getView().byId("id_dialogaddentries").close();this.getView().byId("id_add_entrysave").setEnabled(false);this.getView().byId("id_add_entry_submit").setEnabled(false);this.getView().byId("id_add_entrytemplate").setEnabled(false);this.getView().byId("id_templatecombo").setSelectedKey("")},handleDateChangeadd_entries:function(e){var t=this.getView().byId("id_add_entrysave");var a=this.getView().byId("id_add_entry_submit");var s=this.getView().byId("id_add_entrytemplate");var i=this;var r=[],n=e.getParameter("from"),o=e.getParameter("to"),l=e.getParameter("value"),d=e.getParameter("valid"),g=e.getSource();if(d){g.setValueState(ne.None);r=l.split("–");if(r.length>1){I=r[0].trim();x=r[1].trim();var m=this._datediff(n,o);if(m>6){g.setValueState(ne.Error);g.setValueStateText("Date Range should be with in 7 days");t.setEnabled(false);a.setEnabled(false);s.setEnabled(true)}else{if(m===6){var u=new Date(I);var h=u.getDay();var c=new Date(x);var c=c.getDay();if(h!==6&&c!==5){g.setValueState(ne.Error);g.setValueStateText("Date Range should start Week Days(Saturday - Friday)");t.setEnabled(false);a.setEnabled(false);s.setEnabled(true)}}else if(m<=5){var u=new Date(I);var h=u.getDay();if(h===6){A=new sap.ui.model.json.JSONModel({start:u,end:new Date(new Date(u).getTime()+5184e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===5){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-5184e5),end:u});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===4){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-432e6),end:new Date(new Date(u).getTime()+864e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===3){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-3456e5),end:new Date(new Date(u).getTime()+1728e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===2){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-2592e5),end:new Date(new Date(u).getTime()+2592e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===1){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-1728e5),end:new Date(new Date(u).getTime()+3456e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===0){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-864e5),end:new Date(new Date(u).getTime()+432e6)});A.refresh();i.getView().setModel(A,"DateModel1")}}else{g.setValueState(ne.None);g.setValueStateText("");t.setEnabled(false);a.setEnabled(false);s.setEnabled(false)}}}else{I=r[0].trim();x=r[0].trim();var u=new Date(I);var h=u.getDay();if(h===6){A=new sap.ui.model.json.JSONModel({start:u,end:new Date(new Date(u).getTime()+5184e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===5){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-5184e5),end:u});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===4){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-432e6),end:new Date(new Date(u).getTime()+864e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===3){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-3456e5),end:new Date(new Date(u).getTime()+1728e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===2){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-2592e5),end:new Date(new Date(u).getTime()+2592e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===1){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-1728e5),end:new Date(new Date(u).getTime()+3456e5)});A.refresh();i.getView().setModel(A,"DateModel1")}else if(h===0){A=new sap.ui.model.json.JSONModel({start:new Date(new Date(u).getTime()-864e5),end:new Date(new Date(u).getTime()+432e6)});A.refresh();i.getView().setModel(A,"DateModel1")}t.setEnabled(true);a.setEnabled(true)}}else{g.setValueState(ne.Error);g.setValueStateText("Invalid Date");t.setEnabled(false);a.setEnabled(false)}},adddatechange:function(e){var t=e.getSource();var a=t.getValue();var s=new Date(a);var i=this.getView().byId("id_add_entrysave");var r=this.getView().byId("id_add_entry_submit");var n=this.getView().byId("id_add_entrytemplate");var o=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var l=this.getView().getModel("DateModel1").getProperty("/");var d=o.format(l.start);var g=o.format(l.end);var m=o.format(s);if(m>=d&&m<=g){t.setValueState(ne.None);t.setValueStateText("");i.setEnabled(true);r.setEnabled(true);n.setEnabled(true)}else{t.setValueState(ne.Error);t.setValueStateText("Date should be in the selected Time Period");i.setEnabled(false);r.setEnabled(false);n.setEnabled(false)}},taskChange:function(e){var t=this.getView().byId("id_add_entrysave");var a=this.getView().byId("id_add_entry_submit");var s=this.getView().byId("id_add_entrytemplate");var i=e.getSource(),r=i.getSelectedKey(),n=i.getValue();if(!r&&n){i.setValueState(ne.Error);i.setValueStateText("Please enter a valid Task Type");t.setEnabled(false);a.setEnabled(false);s.setEnabled(false)}else{i.setValueState(ne.None);t.setEnabled(true);a.setEnabled(true);s.setEnabled(true)}},wbsChange:function(e){var t=this.getView().byId("id_add_entrysave");var a=this.getView().byId("id_add_entry_submit");var s=this.getView().byId("id_add_entrytemplate");var i=e.getSource(),r=i.getSelectedKey(),n=i.getValue();if(!r&&n){i.setValueState(ne.Error);i.setValueStateText("Please enter a valid WBS Element");t.setEnabled(false);a.setEnabled(false);s.setEnabled(false)}else{i.setValueState(ne.None);t.setEnabled(true);a.setEnabled(true);s.setEnabled(true)}},getWbsElement:function(e,t,a){var s=[];var i=this;var r,n,o;var l,d;var g=new Date(t);l=g.getFullYear();d=g.getMonth()+1;var m=d.toString();var u=m.padStart(3,"0");P=this.getOwnerComponent().getModel("WbsElementService");J=new sap.ui.model.json.JSONModel;if(a===true){r=new sap.ui.model.Filter("PersonExternalID","EQ",e);s.push(r)}n=new sap.ui.model.Filter("FiscalYear","EQ",l);s.push(n);o=new sap.ui.model.Filter("FiscalPeriod","EQ",u);s.push(o);z=new sap.m.BusyDialog({title:"Loading Data",text:"Please wait....."});z.open();P.read("/MyWbsElement",{filters:s,urlParameters:{$top:999999},success:function(e){if(e.results.length!==0){J.setData(e.results);i.getView().setModel(J,"ResourceWbs");i._setwbsDialog()}else{y.warning("No Wbs Element Data Found. Please try with another Date..");z.close()}}.bind(this),error:function(e){z.close()}.bind(this)})},onAddWbsVH:function(e){$=e.getSource();var t;var a=e.getSource().getParent().getCells()[1].getValue();var s=this.getView().byId("id_employee_extid").getText();if(C.oData.configFile[0].WbsElementEmployee===true){t=true}else{t=false}console.log(C);this.getWbsElement(s,a,t)},_setwbsDialog:function(){this._oBasicSearchFieldWithSuggestionsWbs=new d;this.pDialogWithSuggestionsWbs=this.loadFragment({name:"timesheetentry.view.WbsVH"}).then(function(e){var t=e.getFilterBar(),a,s,i,r,o,l,d,m,c,p,w;this._oVHDWithSuggestionsWbs=e;this.getView().addDependent(e);e.setRangeKeyFields([{label:"Engagement Project",key:"EngagementProject",type:"string",typeInstance:new h({},{maxLength:20})}]);t.setFilterBarExpanded(false);t.setBasicSearch(this._oBasicSearchFieldWithSuggestionsWbs);this._oBasicSearchFieldWithSuggestionsWbs.attachSearch(function(){t.search()});e.getTableAsync().then(function(t){if(t.bindRows){t.bindAggregation("rows",{path:"ResourceWbs>/",events:{dataReceived:function(){e.update()}}});a=new g({label:new u({text:"Engagement Project"}),template:new n({wrapping:false,text:"{ResourceWbs>EngagementProject}"})});a.data({fieldName:"EngagementProject"});t.addColumn(a);s=new g({label:new u({text:"Engagement Project Name"}),template:new n({wrapping:false,text:"{ResourceWbs>EngagementProjectName}"})});s.data({fieldName:"EngagementProjectName"});t.addColumn(s);i=new g({label:new u({text:"Work Package"}),template:new n({wrapping:false,text:"{ResourceWbs>WorkPackage}"})});i.data({fieldName:"WorkPackage"});t.addColumn(i);r=new g({label:new u({text:"Work Package Name"}),template:new n({wrapping:false,text:"{ResourceWbs>WorkPackageName}"})});r.data({fieldName:"WorkPackageName"});t.addColumn(r);o=new g({label:new u({text:"Work Package InternalId"}),template:new n({wrapping:false,text:"{ResourceWbs>WBSElementInternalID}"})});o.data({fieldName:"WBSElementInternalID"});t.addColumn(o);l=new g({label:new u({text:"Project Resource Type"}),template:new n({wrapping:false,text:"{ResourceWbs>EngagementProjectResourceType}"})});l.data({fieldName:"EngagementProjectResourceType"});t.addColumn(l);d=new g({label:new u({text:"Project Resource Text"}),template:new n({wrapping:false,text:"{ResourceWbs>EngagementProjResourceTypeText}"})});d.data({fieldName:"EngagementProjResourceTypeText"});t.addColumn(d);m=new g({label:new u({text:"Project Resource"}),template:new n({wrapping:false,text:"{ResourceWbs>EngagementProjectResource}"})});m.data({fieldName:"EngagementProjectResource"});t.addColumn(m);c=new g({label:new u({text:"Project Resource Text"}),template:new n({wrapping:false,text:"{ResourceWbs>EngagementProjResourceText}"})});c.data({fieldName:"EngagementProjResourceText"});t.addColumn(c);p=new g({label:new u({text:"Startdate"}),template:new n({wrapping:false,text:"{ResourceWbs>WorkPackageStartDate}"})});p.data({fieldName:"WorkPackageStartDate"});t.addColumn(p);w=new g({label:new u({text:"Enddate"}),template:new n({wrapping:false,text:"{ResourceWbs>WorkPackageEndDate}"})});w.data({fieldName:"WorkPackageEndDate"});t.addColumn(w)}}.bind(this));e.open();z.close()}.bind(this))},onValueHelpWbsVHOkPress:function(e){var t=this.getView().byId("id_add_entrysave");var a=this.getView().byId("id_add_entry_submit");var s=this.getView().byId("id_add_entrytemplate");var i=e.getParameter("tokens");if(i.length>0){var r=i[0].getKey();var n=i[0].getAggregation("customData");var o=n[0].getProperty("value");$.setValue(o.WorkPackage+"-"+o.EngagementProjectResource);$.setValueState(ne.None);$.setValueStateText("");t.setEnabled(true);a.setEnabled(true);s.setEnabled(true)}this._oVHDWithSuggestionsWbs.close()},onValueHelpWbsVHCancelPress:function(e){this._oVHDWithSuggestionsWbs.close()},onValueHelpWbsVHAfterClose:function(e){this._oVHDWithSuggestionsWbs.destroy()},onFilterBarWithSuggestionsWbsVHSearch:function(e){var t=this._oBasicSearchFieldWithSuggestionsWbs.getValue(),a=e.getParameter("selectionSet"),s=a.reduce(function(e,t){if(t.getValue()){e.push(new l({path:t.getName(),operator:p.Contains,value1:t.getValue()}))}return e},[]);s.push(new l({filters:[new l({path:"EngagementProject",operator:p.Contains,value1:t})],and:false}));this._filterTableWithSuggestionsWbs(new l({filters:s,and:true}))},_filterTableWithSuggestionsWbs:function(e){var t=this._oVHDWithSuggestionsWbs;t.getTableAsync().then(function(a){if(a.bindRows){a.getBinding("rows").filter(e)}if(a.bindItems){a.getBinding("items").filter(e)}t.update()})},_entriesValidations:function(e){var t=this.byId("id_add_employee_extid");var a=this.byId("id_add_wrkid");var s=this.byId("id_add_ccode");var i;var r=s.getSelectedKey();var n=t.getText();var o=a.getText();i=false;if(r==""||r==null){i=true}if(n==""||n==null){i=true}if(o==""||o==null){i=true}if(i===false){for(let t=0;t<e.length;t++){if(i===false){if((e[t].TimesheetDate==null||e[t].TimesheetDate=="")&&(e[t].RecordedHours==null||e[t].RecordedHours==""||e[t].RecordedHours=="0")&&(e[t].TaskType==null&&e[t].WBSElemt==null||e[t].TaskType==""&&e[t].WBSElemt=="")){i=false}else{if(e[t].TimesheetDate==null||e[t].TimesheetDate==""){i=true}if(e[t].RecordedHours==null||e[t].RecordedHours==""){i=true}if(e[t].TaskType==null||e[t].TaskType==""){if(e[t].WBSElemt==null||e[t].WBSElemt==""){i=true}}}}}}return i},onsubmitDialog:async function(){var e;e=this;var t=e.getView();U=new sap.m.BusyDialog({title:"Saving",text:"Please wait....."});U.open();var a=[];var s=[];var i=this.byId("id_alert");var r=sap.ui.getCore().getMessageManager();t.setModel(r.getMessageModel(),"message");sap.ui.getCore().getMessageManager().removeAllMessages();var n=this.byId("id_add_employee_extid");var o=this.byId("id_add_wrkid");var l=this.byId("id_add_ccode");var d=this.byId("id_add_ccenter");var g=this.getView().byId("tableId1");var m=g.getBinding("items");a=m.oList;var u=this.getOwnerComponent().getModel();var h=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var c=this._entriesValidations(a);if(c===false){for(let t=0;t<a.length;t++){if((a[t].TimesheetDate==null||a[t].TimesheetDate=="")&&(a[t].RecordedHours==null||a[t].RecordedHours==""||a[t].RecordedHours=="0")&&(a[t].TaskType==null&&a[t].WBSElemt==null||a[t].TaskType==""&&a[t].WBSElemt=="")){continue}else{var p={};var w=[];M=M+1;p.PersonWorkAgreementExternalID=n.getText();p.PersonWorkAgreement=X;var D=h.format(a[t].TimesheetDate);p.TimeSheetDate=D+"T00:00:00";p.TimeSheetStatus="30";p.TimeSheetOperation="C";p.CompanyCode=this.getView().byId("id_add_ccode").getSelectedKey();p.TimeSheetIsExecutedInTestRun=false;p.TimeSheetIsReleasedOnSave=true;p.TimeSheetDataFields_RecordedHours=a[t].RecordedHours;p.TimeSheetDataFields_RecordedQuantity=a[t].RecordedHours;if(a[t].WBSElemt){w=a[t].WBSElemt.split("-");p.TimeSheetDataFields_WBSElement=w[0];p.TimeSheetDataFields_ActivityType=w[1]}p.TimeSheetDataFields_TimeSheetTaskType=a[t].TaskType;p.TimeSheetDataFields_ReceiverPubSecFuncnlArea="YB40";p.TimeSheetDataFields_HoursUnitOfMeasure="H";if(a[t].TaskType){p.TimeSheetDataFields_TimeSheetTaskComponent="WORK";p.TimeSheetDataFields_TimeSheetTaskLevel="NONE"}else{p.TimeSheetDataFields_TimeSheetTaskComponent="";p.TimeSheetDataFields_TimeSheetTaskLevel=""}s[t]=p;let i=await e._postEntries(B,s[t],t,M)}}le.setData(_);e.getView().setModel(le,"CreateMessageData");le.refresh(true);e._logmessage()}else{var f=new T({message:"Fill all the details- Employee External Id,Person Worker Agreement ID,Company Code,Task Type/WBS Element, Recorded Hours",type:L.Error,target:"/Dummy",processor:this.getView().getModel()});i.setIcon("sap-icon://error");i.setType("Reject");sap.ui.getCore().getMessageManager().addMessages(f);U.close()}},_postEntries:function(e,t,a,s){return new Promise((a,s)=>{e.create("/MyTimesheet",t,{success:function(e,s){E=E+1;if(s.statusCode=="201"){var i={};i.Status="S";i.RecordedHours=t.TimeSheetDataFields_RecordedHours;i.Taskid=t.TimeSheetDataFields_TimeSheetTaskType;i.Wbselement=t.TimeSheetDataFields_WBSElement;i.TimeSheetDate=t.TimeSheetDate;i.Message='Entry successfully created on "'+t.TimeSheetDate+'", with a duration of "'+t.TimeSheetDataFields_RecordedHours+'" hours. ';_.push(i);a(e)}}.bind(this),error:function(e){E=E+1;var a=JSON.parse(e.responseText);var i={};i.Status="E";i.RecordedHours=t.TimeSheetDataFields_RecordedHours;i.Taskid=t.TimeSheetDataFields_TimeSheetTaskType;i.Wbselement=t.TimeSheetDataFields_WBSElement;i.TimeSheetDate=t.TimeSheetDate;i.Message=a.error.message.value;_.push(i);s(e)}.bind(this)})})},_logmessage:function(){re=this.byId("dialogmessageboxcreate");if(!re){re=new sap.ui.xmlfragment(this.getView().getId(),"timesheetentry.view.MessageBox",this);this.getView().addDependent(re);re.open()}else{re.open()}},onmessageboxCloseDialog:function(){var e=this;sap.ui.getCore().getMessageManager().removeAllMessages();E=0;M=0;_=[];le.setData(_);this.getView().setModel(le,"CreateMessageData");le.refresh(true);b=[];k.setData(b);e.getView().setModel(k,"Entries");k.refresh(true);this.byId("dialogmessageboxcreate").close();U.close();this.getView().byId("id_dialogaddentries").close()},ondeleterow:function(e){var t=new sap.m.BusyDialog({title:"Processing Deletion of Record",text:"Please wait....."});t.open();var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var s={};var o=this.getOwnerComponent().getModel("TimesheetDeleteService");var l=this.getView().byId("id_employee_extid");var d=e.getSource().getParent();var g=d.getCells();var m=l.getText();var u=X;var h=g[0].getValue();var c=g[9].getText();var p=g[12].getText();var w=g[10].getText();var T=g[13].getText();var D=g[11].getText();var f=g[5].getText();var y=g[5].getText();var v=g[14].getText();var S=g[15].getText();var b=g[16].getText();s.PersonWorkAgreementExternalID=m;s.PersonWorkAgreement=u;var _=new Date(h);var M=a.format(_);s.TimeSheetDate=M+"T00:00:00";s.TimeSheetRecord=c;s.CompanyCode=S;s.TimeSheetOperation="D";s.TimeSheetIsReleasedOnSave=true;s.TimeSheetIsExecutedInTestRun=false;s.TimeSheetDataFields_TimeSheetTaskType=p;s.TimeSheetDataFields_TimeSheetTaskComponent=w;s.TimeSheetDataFields_TimeSheetTaskLevel=T;s.TimeSheetDataFields_ReceiverCostCenter=D;s.TimeSheetDataFields_RecordedHours=f;s.TimeSheetDataFields_RecordedQuantity=y;s.TimeSheetDataFields_ControllingArea=v;s.TimeSheetDataFields_WBSElement=b;s.TimeSheetDataFields_HoursUnitOfMeasure="H";o.create("/MyTimesheetDelete",s,{success:function(e,a){if(a.statusCode=="201"){this.oLogMessageDeleteDialog=new i({type:Q.Message,title:"Information",state:ne.Information,content:new n({text:'"'+c+'"'+" "+"Record deleted Successfully."}),beginButton:new r({type:K.Emphasized,text:"Ok",press:function(){this.oLogMessageDeleteDialog.close();t.close();this._bindtimesheet(m,I,x)}.bind(this)})});this.oLogMessageDeleteDialog.open()}}.bind(this),error:function(e){var a=JSON.parse(e.responseText);this.oLogMessageDeleteDialogerror=new i({type:Q.Message,title:"Information",state:ne.Information,content:new n({text:'"'+a.error.message.value+'"'}),beginButton:new r({type:K.Emphasized,text:"Ok",press:function(){this.oLogMessageDeleteDialogerror.close();t.close()}.bind(this)})});this.oLogMessageDeleteDialogerror.open()}.bind(this)})},ondelete:async function(e){G=new sap.m.BusyDialog({title:"Processing Deletion of Records",text:"Please wait....."});G.open();var t=this.getOwnerComponent().getModel("TimesheetDeleteService");var a=[];var s=this;var i=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var r=this.getView().byId("id_employee_extid");var n=this.getView().byId("daysTable");var o=n.getSelectedItems();if(o){for(var l=0;l<o.length;l++){var d={};var g=o[l].getCells();d.PersonWorkAgreementExternalID=r.getText();d.PersonWorkAgreement=X;var m=new Date(g[0].getValue());var u=i.format(m);d.TimeSheetDate=u+"T00:00:00";d.TimeSheetRecord=g[9].getText();d.CompanyCode=g[15].getText();d.TimeSheetOperation="D";d.TimeSheetIsReleasedOnSave=true;d.TimeSheetIsExecutedInTestRun=false;d.TimeSheetDataFields_TimeSheetTaskType=g[12].getText();d.TimeSheetDataFields_TimeSheetTaskComponent=g[10].getText();d.TimeSheetDataFields_TimeSheetTaskLevel=g[13].getText();d.TimeSheetDataFields_ReceiverCostCenter=g[11].getText();d.TimeSheetDataFields_RecordedHours=g[5].getText();d.TimeSheetDataFields_RecordedQuantity=g[5].getText();d.TimeSheetDataFields_ControllingArea=g[14].getText();d.TimeSheetDataFields_WBSElement=g[16].getText();d.TimeSheetDataFields_HoursUnitOfMeasure="H";a[l]=d;let e=await s._deleteallrecords(t,a[l])}s._logmessageError()}},_deleteallrecords:function(e,t){return new Promise((a,s)=>{e.create("/MyTimesheetDelete",t,{success:function(e,t){if(t.statusCode=="201"){a(t)}}.bind(this),error:function(e){var t=JSON.parse(e.responseText);s(t)}.bind(this)})})},_logmessageError:function(){var e=this;var t=this.getView().byId("id_employee_extid");var a=t.getText();this.oLogMessagedeleteAllDialog=new i({type:Q.Message,title:"Information",state:ne.Information,content:new n({text:"Entries Processed for Deletion"}),beginButton:new r({type:K.Emphasized,text:"Ok",press:function(){V=0;this.oLogMessagedeleteAllDialog.close();G.close();e._bindtimesheet(a,I,x)}.bind(this)})});this.oLogMessagedeleteAllDialog.open()},onsaveDialog:async function(e){var t;t=this;var a=t.getView();U=new sap.m.BusyDialog({title:"Saving",text:"Please wait....."});U.open();var s=[];var i=[];var r=this.byId("id_alert");var n=sap.ui.getCore().getMessageManager();a.setModel(n.getMessageModel(),"message");sap.ui.getCore().getMessageManager().removeAllMessages();var o=this.byId("id_add_employee_extid");var l=this.byId("id_add_wrkid");var d=this.byId("id_add_ccode");var g=this.byId("id_add_ccenter");var m=this.getView().byId("tableId1");var u=m.getBinding("items");s=u.oList;var h=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var c=this._entriesValidations(s);if(c===false){for(let e=0;e<s.length;e++){if((s[e].TimesheetDate==null||s[e].TimesheetDate=="")&&(s[e].RecordedHours==null||s[e].RecordedHours==""||s[e].RecordedHours=="0")&&(s[e].TaskType==null&&s[e].WBSElemt==null||s[e].TaskType==""&&s[e].WBSElemt=="")){continue}else{var p={};var w=[];p.PersonWorkAgreementExternalID=o.getText();p.PersonWorkAgreement=X;var D=h.format(s[e].TimesheetDate);p.TimeSheetDate=D+"T00:00:00";p.TimeSheetStatus="10";p.TimeSheetOperation="C";p.CompanyCode=this.getView().byId("id_add_ccode").getSelectedKey();p.TimeSheetIsExecutedInTestRun=false;p.TimeSheetIsReleasedOnSave=false;p.TimeSheetDataFields_RecordedHours=s[e].RecordedHours;p.TimeSheetDataFields_RecordedQuantity=s[e].RecordedHours;if(s[e].WBSElemt){w=s[e].WBSElemt.split("-");p.TimeSheetDataFields_WBSElement=w[0];p.TimeSheetDataFields_ActivityType=w[1]}p.TimeSheetDataFields_TimeSheetTaskType=s[e].TaskType;p.TimeSheetDataFields_ReceiverPubSecFuncnlArea="YB40";p.TimeSheetDataFields_HoursUnitOfMeasure="H";if(s[e].TaskType){p.TimeSheetDataFields_TimeSheetTaskComponent="WORK";p.TimeSheetDataFields_TimeSheetTaskLevel="NONE"}else{p.TimeSheetDataFields_TimeSheetTaskComponent="";p.TimeSheetDataFields_TimeSheetTaskLevel=""}i[e]=p;let a=await t._postEntries(B,i[e],e,M)}}le.setData(_);t.getView().setModel(le,"CreateMessageData");le.refresh(true);t._logmessage()}else{var f=new T({message:"Fill all the details- Employee External Id,Person Worker Agreement ID,Company Code,Task Type/WBS Element, Recorded Hours",type:L.Error,target:"/Dummy",processor:this.getView().getModel()});r.setIcon("sap-icon://error");r.setType("Reject");sap.ui.getCore().getMessageManager().addMessages(f);U.close()}},downloadButton:function(){var e,t,a,s,i;if(!this._oTable){this._oTable=this.byId("iddialogmessageboxTable")}i=this._oTable;t=i.getBinding("items");e=this._createColumnConfig();a={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:"Timesheet Entry logs.xlsx"};s=new f(a);s.build().finally(function(){s.destroy()})},_createColumnConfig:function(){var e=[];e.push({label:"Status",type:oe.String,property:"Status"});e.push({label:"Recorded Hours",property:"TimeSheetDate",type:oe.String});e.push({label:"Task Id",property:"Taskid",type:oe.String});e.push({label:"WBS Element",property:"Wbselement",type:oe.String});e.push({label:"Recorded Hours",property:"RecordedHours",type:oe.Number,scale:5});e.push({label:"Message",property:"Message",type:oe.String});return e},onMessagePopoverPress:function(e){var t=e.getSource();this._getMessagePopover().then(function(e){e.openBy(t)})},_getMessagePopover:function(){var e=this.getView();if(!this._pMessagePopover){this._pMessagePopover=w.load({id:e.getId(),name:"timesheetentry.view.MessageManager"}).then(function(t){e.addDependent(t);return t})}return this._pMessagePopover},onupdatesubmit:async function(){G=new sap.m.BusyDialog({title:"Processing Submission of Records",text:"Please wait....."});G.open();var e=this.getOwnerComponent().getModel();e.setUseBatch(true);var t=[];var a=this;var s=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var i=this.getView().byId("id_employee_extid");var r=this.getView().byId("id_wrkid_add");var n=this.getView().byId("daysTable");var o=n.getSelectedItems();if(o){for(var l=0;l<o.length;l++){var d={};var g=o[l].getCells();d.PersonWorkAgreementExternalID=i.getText();d.PersonWorkAgreement=X;var m=new Date(g[0].getValue());var u=s.format(m);d.TimeSheetDate=u+"T00:00:00";d.TimeSheetRecord=g[9].getText();d.CompanyCode=g[15].getText();d.TimeSheetOperation="U";d.TimeSheetStatus="30";d.TimeSheetIsReleasedOnSave=true;d.TimeSheetIsExecutedInTestRun=false;d.TimeSheetDataFields_TimeSheetTaskType=g[12].getText();d.TimeSheetDataFields_TimeSheetTaskComponent=g[10].getText();d.TimeSheetDataFields_TimeSheetTaskLevel=g[13].getText();d.TimeSheetDataFields_ReceiverCostCenter=g[11].getText();d.TimeSheetDataFields_RecordedHours=g[5].getText();d.TimeSheetDataFields_RecordedQuantity=g[5].getText();d.TimeSheetDataFields_ControllingArea=g[14].getText();d.TimeSheetDataFields_WBSElement=g[16].getText();d.TimeSheetDataFields_HoursUnitOfMeasure="H";t[l]=d;let r=await a._deleteallrecords(e,t[l])}a._logmessageError()}},templateChange:async function(e){var t=e.getSource(),a=t.getSelectedKey(),s=[],i=this,r=this.byId("id_add_employee_extid").getText(),n=this.getOwnerComponent().getModel("TimesheetPreviousService"),o=this.getOwnerComponent().getModel("SavetemplateService"),l=new sap.ui.model.Filter("PersonWorkAgreementExternalID","EQ",r);s.push(l);if(a=="1"){Y=new sap.m.BusyDialog({title:"loading Previous Timecard",text:"Please wait....."});Y.open();var d=new Date((new Date).getTime()-6048e5);i._getdates(d);if(ge&&me){var g=ge+"T00:00:00Z";var m=me+"T23:59:59Z";var u=new sap.ui.model.Filter("TimeSheetDate","BT",g,m);s.push(u)}let e=await i._getpreviousdata(n,s);if(e.length>0){var h=new Date;k=new sap.ui.model.json.JSONModel;i._getdates(h);let t=i._getDateRange(ge,me);if(t){console.log(t);b=[];for(S=0;S<e.length;S++){console.log(new Date(e[S].TimeSheetDate));let a=t.filter(function(t){return t.Day===new Date(e[S].TimeSheetDate).getDay()});console.log(a[0].Date);var c={};c.Id=S;c.TimesheetDate=a[0].Date;c.TaskType=e[S].TimeSheetTaskType;c.WBSElemt="";c.RecordedHours=e[S].RecordedHours;c.RecordedQuantity=e[S].RecordedHours;b.push(c)}b.sort(function(e,t){var a=new Date(e.TimesheetDate);var s=new Date(t.TimesheetDate);return a-s});k.setData(b);i.getView().setModel(k,"Entries");k.refresh(true);Y.close();this.getView().byId("id_add_entrysave").setEnabled(true);this.getView().byId("id_add_entry_submit").setEnabled(true);this.getView().byId("id_add_entrytemplate").setEnabled(false)}}}else if(a=="2"){Z=new sap.m.BusyDialog({title:"Loading Data",text:"Please wait....."});Z.open();var p=this.getView().byId("id_employee_extid").getText(),T=this.getView();let e=await i._getTemplates(o,p);if(e){de.setData(e);de.refresh();i.getView().setModel(de,"AllTemplates");if(!this._pValueHelpDialog){this._pValueHelpDialog=w.load({id:T.getId(),name:"timesheetentry.view.GetTemplates",controller:this}).then(function(e){T.addDependent(e);return e})}this._pValueHelpDialog.then(function(e){Z.close();e.open()})}else{de.setData(e);de.refresh();i.getView().setModel(de,"AllTemplates");if(!this._pValueHelpDialog){this._pValueHelpDialog=w.load({id:T.getId(),name:"timesheetentry.view.GetTemplates",controller:this}).then(function(e){T.addDependent(e);return e})}this._pValueHelpDialog.then(function(e){Z.close();e.open()})}}else{var i=this;k=new sap.ui.model.json.JSONModel;b=[];for(S=0;S<=4;S++){var c={};c.Id=S;c.TimesheetDate="";c.TaskType="";c.WBSElemt="";c.RecordedHours="0";c.RecordedQuantity="0";b.push(c)}k.setData(b);i.getView().setModel(k,"Entries");k.refresh(true);this.getView().byId("id_add_entrysave").setEnabled(false);this.getView().byId("id_add_entry_submit").setEnabled(false)}},_getpreviousdata:async function(e,t){return new Promise((a,s)=>{e.read("/MyTimesheetPreviousDetails",{filters:t,urlParameters:{$top:999999},success:function(e){console.log(e.results);a(e.results)}.bind(this),error:function(e){console.log(e)}.bind(this)})})},_getdates:function(e){var t=new Date(e);var a=t.getDay();var s,i;var r=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});if(a===6){s=t;i=new Date(new Date(t).getTime()+5184e5);ge=r.format(s);me=r.format(i)}else if(a===5){s=new Date(new Date(t).getTime()-5184e5);i=t;ge=r.format(s);me=r.format(i)}else if(a===4){s=new Date(new Date(t).getTime()-432e6);i=new Date(new Date(t).getTime()+864e5);ge=r.format(s);me=r.format(i)}else if(a===3){s=new Date(new Date(t).getTime()-3456e5);i=new Date(new Date(t).getTime()+1728e5);ge=r.format(s);me=r.format(i)}else if(a===2){s=new Date(new Date(t).getTime()-2592e5);i=new Date(new Date(t).getTime()+2592e5);ge=r.format(s);me=r.format(i)}else if(a===1){s=new Date(new Date(t).getTime()-1728e5);i=new Date(new Date(t).getTime()+3456e5);ge=r.format(s);me=r.format(i)}else if(a===0){s=new Date(new Date(t).getTime()-864e5);i=new Date(new Date(t).getTime()+432e6);ge=r.format(s);me=r.format(i)}},_getDateRange:function(e,t){var a=0,s=[],i;var r={};r.Date=new Date(e);r.Day=new Date(e).getDay();s.push(r);do{let t={};if(a==0){i=new Date(new Date(e).getTime()+864e5)}else{i=new Date(i.getTime()+864e5)}t.Date=i;t.Day=i.getDay();s.push(t);a++}while(a<5);var r={};r.Date=new Date(t);r.Day=new Date(t).getDay();s.push(r);return s},ontemplateDialog:async function(){var e=this.byId("id_dialogtemplateentries");if(!e){e=new sap.ui.xmlfragment(this.getView().getId(),"timesheetentry.view.SaveTemplate",this);this.getView().addDependent(e);e.open()}else{e.open()}},_saveTemplate:function(e,t){return new Promise((a,s)=>{e.create("/SaveTemplate",{entries:t},{success:function(e,t){if(t.statusCode=="200"){a(t)}else{a(t)}}.bind(this),error:function(e){var t=JSON.parse(e.responseText);s(t)}.bind(this)})})},_getTemplates:function(e,t){return new Promise((a,s)=>{e.callFunction("/GetTemplates",{method:"GET",urlParameters:{EmployeeExternalId:t},success:function(e){var t=e.results;console.log(t);if(t.length>0){a(t)}else{a(t)}},error:function(e){s(e)}})})},ongettemplateSearch:function(e){var t=e.getParameter("value");var a=new l("TemplateDescription",p.Contains,t);var s=e.getParameter("itemsBinding");s.filter([a])},ongettemplateClose:async function(e){var t=this.getOwnerComponent().getModel("SavetemplateService"),a=this,s=new Date,i=e.getParameter("selectedItem");var r=new sap.m.BusyDialog({title:"Loading Data",text:"Please wait....."});r.open();if(i){var n=i.getDescription();var o=await a._getTemplate(t,n);if(o.length>0){k=new sap.ui.model.json.JSONModel;a._getdates(s);let e=a._getDateRange(ge,me);b=[];for(S=0;S<o.length;S++){console.log(new Date(o[S].Date));let t=e.filter(function(e){return e.Day===o[S].Day});console.log(t[0].Date);var l={};l.Id=S;l.TimesheetDate=t[0].Date;l.TaskType=o[S].TaskType;l.WBSElemt=o[S].WBSElement;l.RecordedHours=o[S].RecordedHours;l.RecordedQuantity=o[S].RecordedHours;b.push(l)}b.sort(function(e,t){var a=new Date(e.TimesheetDate);var s=new Date(t.TimesheetDate);return a-s});k.setData(b);a.getView().setModel(k,"Entries");k.refresh(true);this.getView().byId("id_add_entrysave").setEnabled(true);this.getView().byId("id_add_entry_submit").setEnabled(true);this.getView().byId("id_add_entrytemplate").setEnabled(false);r.close()}else{r.close()}}else{r.close()}},_getTemplate:function(e,t){return new Promise((a,s)=>{e.callFunction("/GetTemplate",{method:"GET",urlParameters:{TemplateId:t},success:function(e){var t=e.results;console.log(t);if(t.length>0){a(t)}else{a(t)}},error:function(e){s(e)}})})},ontemplatesaveDialog:async function(){var e;e=this;var t=e.getView();O=this.getOwnerComponent().getModel("SavetemplateService");U=new sap.m.BusyDialog({title:"Saving Template",text:"Please wait....."});U.open();var a=[];var s=[];var i=this.byId("id_alert");var r=sap.ui.getCore().getMessageManager();t.setModel(r.getMessageModel(),"message");sap.ui.getCore().getMessageManager().removeAllMessages();var n=this.byId("id_add_employee_extid");var o=this.getView().byId("id_templateid_save");var l=this.getView().byId("id_templatedesc_save");var d=this.getView().byId("tableId1");var g=d.getBinding("items");a=g.oList;var m=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var u=this._entriesValidations(a);if(u===false){for(let e=0;e<a.length;e++){if((a[e].TimesheetDate==null||a[e].TimesheetDate=="")&&(a[e].RecordedHours==null||a[e].RecordedHours==""||a[e].RecordedHours=="0")&&(a[e].TaskType==null&&a[e].WBSElemt==null||a[e].TaskType==""&&a[e].WBSElemt=="")){continue}else{var h={};h.EmployeeExternalId=n.getText();h.TemplateId=o.getValue();h.TemplateDescription=l.getValue();var c=m.format(a[e].TimesheetDate);h.Date=c;h.RecordedHours=a[e].RecordedHours;h.WBSElement=a[e].WBSElemt;h.TaskType=a[e].TaskType;h.Day=new Date(c).getDay();s.push(h)}}let t=await e._saveTemplate(O,s);if(t){e._logmessageTemplate(t)}}else{var p=new T({message:"Fill all the details- Employee External Id,Person Worker Agreement ID,Company Code,Task Type/WBS Element, Recorded Hours",type:L.Error,target:"/Dummy",processor:this.getView().getModel()});i.setIcon("sap-icon://error");i.setType("Reject");sap.ui.getCore().getMessageManager().addMessages(p);U.close()}},onCloseDialogtemplate:function(){this.getView().byId("id_dialogtemplateentries").close();this.getView().byId("id_templateid_save").setValue("");this.getView().byId("id_templatedesc_save").setValue("")},_logmessageTemplate:function(e){var t=this;var a,s;var o=this.getView().byId("id_templateid_save");var l=o.getValue();if(e.statusCode=="200"){a="Template-"+" "+l+" "+"Saved Successfully";s=ne.Information}else{a="Template-"+" "+l+" "+"failed to save";s=ne.Error}this.oLogMessageTemplateDialog=new i({type:Q.Message,title:"Information",state:s,content:new n({text:a}),beginButton:new r({type:K.Emphasized,text:"Ok",press:function(){this.oLogMessageTemplateDialog.close();b=[];M=0;k.setData(b);t.getView().setModel(k,"Entries");k.refresh(true);sap.ui.getCore().getMessageManager().removeAllMessages();this.getView().byId("id_dialogaddentries").close();this.getView().byId("id_add_entrysave").setEnabled(false);this.getView().byId("id_add_entry_submit").setEnabled(false);this.getView().byId("id_add_entrytemplate").setEnabled(false);this.getView().byId("id_templatecombo").setSelectedKey("");this.getView().byId("id_dialogtemplateentries").close();this.getView().byId("id_templateid_save").setValue("");this.getView().byId("id_templatedesc_save").setValue("");U.close()}.bind(this)})});this.oLogMessageTemplateDialog.open()}})});
//# sourceMappingURL=timesheet_view.controller.js.map